# üöÄ Resume Matcher Upload System - Production Deployment

## Architecture Overview

```
Frontend (Vercel) ‚Üí Backend API (Render) ‚Üí PostgreSQL + Persistent Disk
```

## Deployment Instructions

### 1. Backend Deployment (Render)

1. **Create PostgreSQL Database first:**
   - Go to Render Dashboard
   - Create new PostgreSQL service
   - Name: `resume-matcher-db`
   - Plan: Starter ($7/month)
   - Database Name: `resume_matcher` 
   - User: `resume_user`

2. **Create Web Service:**
   - Repository: `https://github.com/ririyg420/resume-matcher-private`
   - Branch: `security-hardening-neon`
   - Root Directory: `apps/backend`
   - Build Command: `npm install && npx prisma generate && npm run build`
   - Start Command: `npm run start`

3. **Add Persistent Disk:**
   - Name: `upload-storage`
   - Size: 10GB
   - Mount Path: `/var/data`

4. **Environment Variables (Render):**
   ```bash
   NODE_ENV=production
   DATABASE_URL=<auto-generated-from-postgresql-service>
   FILES_DIR=/var/data
   ADMIN_TOKEN=<generate-secure-random-token>
   ```

   **Important:** DATABASE_URL wird automatisch von Render gesetzt wenn Sie die PostgreSQL Datenbank verlinken!

### 2. Frontend Deployment (Vercel)

1. **Deploy from GitHub:**
   - Repository: `https://github.com/ririyg420/resume-matcher-private`
   - Framework: Next.js
   - Root Directory: `apps/frontend`

2. **Environment Variables (Vercel):**
   ```bash
   NEXT_PUBLIC_BACKEND_URL=https://your-backend.onrender.com
   # Add other existing environment variables...
   ```

## API Endpoints

### Backend (Render)

- `POST /api/uploads` - File upload with multipart form data
- `GET /api/files/{id}` - Secure file download
- `GET /api/admin/uploads` - List all uploads (requires admin token)
- `GET /api/admin/disk` - Disk usage statistics (requires admin token)
- `GET /api/health` - Health check endpoint

### Admin Authentication

All admin endpoints require `Authorization: Bearer <ADMIN_TOKEN>` header.

## File Upload Features

- ‚úÖ **Supported Formats:** PDF, DOCX, DOC
- ‚úÖ **File Size Limit:** 10MB per file
- ‚úÖ **Security:** SHA256 deduplication, MIME type validation
- ‚úÖ **Storage:** Sharded storage on Render Persistent Disk
- ‚úÖ **Streaming:** Memory-efficient uploads and downloads

## Testing

### Frontend Upload Test
Visit: `https://your-frontend.vercel.app/en/upload-test`

### Backend Health Check
Visit: `https://your-backend.onrender.com/api/health`

## Monitoring

- **Health Check:** `/api/health` returns service status and database connectivity
- **Disk Usage:** `/api/admin/disk` (admin only) returns storage statistics
- **File Management:** `/api/admin/uploads` (admin only) lists all uploaded files

## Security

- **File Validation:** MIME type and size restrictions
- **Admin Endpoints:** Protected with Bearer token authentication
- **Secure Downloads:** Proper content headers and streaming
- **PII Protection:** No sensitive data in logs or error messages

## Production URLs

- **Frontend:** `https://your-frontend.vercel.app`
- **Backend:** `https://your-backend.onrender.com`
- **Upload Test:** `https://your-frontend.vercel.app/en/upload-test`

## Environment Configuration

### Development
```bash
# Frontend
NEXT_PUBLIC_BACKEND_URL=http://localhost:4000

# Backend  
DATABASE_URL=postgresql://...
FILES_DIR=./uploads
ADMIN_TOKEN=dev-token
```

### Production
```bash
# Frontend (Vercel)
NEXT_PUBLIC_BACKEND_URL=https://your-backend.onrender.com

# Backend (Render)
DATABASE_URL=postgresql://...
FILES_DIR=/var/data
ADMIN_TOKEN=secure-random-production-token
```

## Troubleshooting

1. **Backend won't start:** Check `DATABASE_URL` connection
2. **File uploads fail:** Verify `FILES_DIR` permissions and disk space
3. **Admin endpoints return 401:** Check `ADMIN_TOKEN` configuration
4. **Frontend can't reach backend:** Verify `NEXT_PUBLIC_BACKEND_URL`

---

**üìç Status:** ‚úÖ Production Ready - Deployed and Tested
