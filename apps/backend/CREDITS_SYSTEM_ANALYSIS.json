{
  "timestamp": "2025-09-02",
  "system_status": "ANALYSIS_COMPLETE",
  "summary": {
    "models_count": 7,
    "services_count": 2,
    "api_routes": 7,
    "total_tests": 22,
    "missing_packages": 2,
    "credits_migrations": 3
  },
  "detailed_analysis": {
    "database_models": {
      "models_found": [
        "PaymentStatus",
        "StripeCustomer",
        "Payment",
        "CreditTransaction",
        "ProcessedEvent",
        "AdminAction",
        "CreditLedger"
      ],
      "relationships": [
        "CreditTransaction",
        "Payment"
      ],
      "constraints": [
        "CheckConstraint: \"amount_total_cents >= 0\"",
        "CheckConstraint: \"expected_credits >= 0\"",
        "UniqueConstraint: \"provider\", \"provider_payment_intent_id\", name=\"uq_provider_pi\"",
        "UniqueConstraint: \"provider\", \"provider_checkout_session_id\", name=\"uq_provider_cs\"",
        "ForeignKey: \"payments.id\", ondelete=\"SET NULL\"",
        "UniqueConstraint: \"provider\", \"provider_event_id\", name=\"uq_provider_event\"",
        "ForeignKey: \"stripe_customers.user_id\", ondelete=\"RESTRICT\""
      ],
      "indexes": [],
      "issues": []
    },
    "service_layer": {
      "services_found": [
        "stripe_provider.py",
        "payment_provider.py"
      ],
      "methods": {
        "stripe_provider.py": [
          "parse_and_verify",
          "get_user_identifier",
          "get_payment_identity",
          "fetch_line_items_and_credits",
          "reconcile_payment"
        ],
        "payment_provider.py": [
          "parse_and_verify",
          "fetch_line_items_and_credits",
          "get_payment_identity",
          "reconcile_payment",
          "get_user_identifier"
        ]
      },
      "async_patterns": [
        "parse_and_verify",
        "get_user_identifier",
        "get_payment_identity",
        "fetch_line_items_and_credits",
        "reconcile_payment",
        "parse_and_verify",
        "fetch_line_items_and_credits",
        "get_payment_identity",
        "reconcile_payment",
        "get_user_identifier"
      ],
      "issues": []
    },
    "api_endpoints": {
      "routes_found": [
        "admin.py",
        "emergency.py",
        "webhooks.backup.py",
        "webhooks.py",
        "webhooks_ultra_emergency.py",
        "billing.py",
        "credits.py"
      ],
      "endpoints": {
        "admin.py": [],
        "emergency.py": [],
        "webhooks.backup.py": [],
        "webhooks.py": [],
        "webhooks_ultra_emergency.py": [],
        "billing.py": [],
        "credits.py": []
      },
      "webhooks": [],
      "issues": []
    },
    "test_coverage": {
      "test_files": [
        "test_happy_path.py",
        "test_idempotency.py",
        "test_negative_cases.py"
      ],
      "test_counts": {
        "test_happy_path.py": 6,
        "test_idempotency.py": 6,
        "test_negative_cases.py": 10
      },
      "total_tests": 22,
      "coverage_areas": [
        "Happy Path",
        "Idempotency",
        "Error Cases"
      ],
      "issues": []
    },
    "configuration": {
      "env_vars": {
        "ASYNC_DATABASE_URL": "postgresql+asyncpg://postgres:test@localhost:5432/...",
        "SYNC_DATABASE_URL": "postgresql+psycopg://postgres:test@localhost:5432/...",
        "STRIPE_SECRET_KEY": "sk_test_...",
        "STRIPE_WEBHOOK_SECRET": "whsec_fa..."
      },
      "required_packages": [
        "pytest",
        "sqlalchemy",
        "asyncpg",
        "psycopg2",
        "stripe"
      ],
      "missing_packages": [
        "pytest-asyncio",
        "pytest-cov"
      ],
      "database_config": {},
      "issues": []
    },
    "migrations": {
      "alembic_dir": true,
      "migration_files": [
        "0001_initial.py",
        "0002_make_content_hash_nullable.py",
        "0003_add_performance_indexes.py",
        "0004_credit_ledger.py",
        "0005_file_uploads.py",
        "0006_production_credits.py"
      ],
      "latest_migration": "0006_production_credits.py",
      "credits_migrations": [
        "0004_credit_ledger.py",
        "0005_file_uploads.py",
        "0006_production_credits.py"
      ],
      "issues": []
    }
  },
  "readiness_score": 85,
  "recommendations": [
    "\u2705 System is nearly production-ready",
    "Install missing packages: pytest-asyncio, pytest-cov"
  ]
}